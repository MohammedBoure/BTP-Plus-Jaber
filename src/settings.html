<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الإعدادات</title>
    <link rel="manifest" href="/manifest.json">
    <script src="js/script.js"></script>
    <script>
        const isAuthenticated = localStorage.getItem('isAuthenticated');
        if (isAuthenticated === 'true') {
            // Keep the authentication state as true
            localStorage.setItem('isAuthenticated', 'false');
        } else if (isAuthenticated === null || isAuthenticated === 'false') {
            if (isAuthenticated ==='false') {
                // Redirect to auth.html with current page URL
                const currentURL = window.location.href;
                const authURL = `auth.html?redirect=${encodeURIComponent(currentURL)}`;
                window.location.href = authURL;
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="/libs/sql.js/sql-wasm.js"></script>
    <script src="/libs/lucide/lucide.min.js"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { primary: '#1E3A8A', success: '#10B981', warning: '#F59E0B', danger: '#EF4444' }, fontFamily: { 'inter': ['Inter', 'Noto Sans Arabic', 'sans-serif'] } } } }
    </script>
    <style>
        body { font-family: 'Inter', 'Noto Sans Arabic', 'sans-serif'; }
        .transition-all { transition: all 0.3s ease; }
        .sidebar-expanded { width: 16rem; } .sidebar-collapsed { width: 4rem; }
        .sidebar-collapsed .nav-text, .sidebar-collapsed #logo-text { opacity: 0; visibility: hidden; transition: opacity 0.1s; }
        .main-content-expanded { margin-right: 16rem; } .main-content-collapsed { margin-right: 4rem; }
        [dir="ltr"] .main-content-expanded { margin-left: 16rem; margin-right: 0; } [dir="ltr"] .main-content-collapsed { margin-left: 4rem; margin-right: 0; }
        .nav-item.active { background-color: #1E3A8A; color: white; } .dark .nav-item.active { background-color: #1E3A8A; }
        .nav-item.active svg, .nav-item.active i { color: white; }
        body { visibility: hidden; opacity: 0; transition: opacity 0.4s ease-in-out; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <!-- Sidebar -->
    <div id="sidebar" class="fixed right-0 top-0 h-full bg-white dark:bg-gray-800 shadow-lg transition-all sidebar-expanded z-30 border-l border-gray-200 dark:border-gray-700">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700"><div class="flex items-center space-x-3 overflow-hidden"><div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center flex-shrink-0"><span class="text-white font-bold text-sm">BM</span></div><span id="logo-text" class="font-bold text-lg text-gray-900 dark:text-white transition-opacity">مدير الأعمال</span></div></div>
        <nav class="mt-6">
            <a href="index.html" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                <i data-lucide="layout-dashboard" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text mr-3 transition-opacity">لوحة التحكم</span>
            </a>
            <a href="products.html" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                <i data-lucide="package" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text mr-3 transition-opacity">المنتجات</span>
            </a>
            <a href="clients.html" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                <i data-lucide="users" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text mr-3 transition-opacity">الزبائن</span>
            </a>
            <a href="sales.html" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                <i data-lucide="shopping-cart" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text mr-3 transition-opacity">المبيعات</span>
            </a>
            <a href="payments.html" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                <i data-lucide="credit-card" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text mr-3 transition-opacity">المدفوعات</span>
            </a>
            <a href="settings.html" class="nav-item flex items-center px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors active">
                <i data-lucide="landmark" class="w-5 h-5 flex-shrink-0"></i><span class="nav-text mr-3 transition-opacity">الإعدادات</span>
            </a>
        </nav>
    </div>

    <!-- Main Content Wrapper -->
    <div id="main-content" class="flex flex-col h-screen transition-all main-content-expanded">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 p-4 flex items-center justify-between flex-shrink-0">
            <div class="flex items-center space-x-4">
                <button onclick="toggleSidebar()" class="p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"><i data-lucide="menu" class="w-5 h-5"></i></button>
                <h1 id="page-title-header" class="text-2xl font-semibold text-gray-900 dark:text-white">الإعدادات</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button onclick="toggleTheme()" class="p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"><i id="theme-icon-light" data-lucide="sun" class="w-5 h-5"></i><i id="theme-icon-dark" data-lucide="moon" class="w-5 h-5 hidden"></i></button>
                <div class="flex items-center space-x-2"><div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center"><span class="text-white text-sm font-medium">A</span></div><span class="text-sm font-medium text-gray-700 dark:text-gray-300">مستخدم إداري</span></div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 p-6 overflow-auto">
            <h1 class="text-2xl font-bold mb-6 text-gray-800 dark:text-white">الإعدادات العامة</h1>

            <!-- Database Operations -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mb-6">
                <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">إدارة قاعدة البيانات</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button id="backup-button" class="w-full bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors flex items-center justify-center gap-2">
                        <i data-lucide="database-backup" class="w-4 h-4"></i><span>نسخ احتياطي</span>
                    </button>
                    <label for="restore-input" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 cursor-pointer">
                        <i data-lucide="upload-cloud" class="w-4 h-4"></i><span>استعادة</span>
                        <input type="file" id="restore-input" accept=".db, .sqlite, .sqlite3" class="hidden">
                    </label>
                    <button id="delete-button" class="w-full bg-danger text-white px-4 py-2 rounded-lg hover:bg-danger/90 transition-colors flex items-center justify-center gap-2">
                        <i data-lucide="trash-2" class="w-4 h-4"></i><span>حذف كل البيانات</span>
                    </button>
                </div>
                <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">تنبيه: إجراءات الحذف والاستعادة لا يمكن التراجع عنها. يرجى أخذ نسخة احتياطية أولاً.</p>
            </div>

            <!-- Password Update -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                <h2 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">تحديث كلمة المرور</h2>
                <form id="password-form" class="max-w-md">
                    <div class="grid grid-cols-1 gap-6">
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">كلمة المرور الجديدة</label>
                            <input type="password" id="password" placeholder="أدخل كلمة مرور قوية" class="p-2 border border-gray-300 rounded-lg w-full dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white">
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors flex items-center justify-center gap-2">
                                <i data-lucide="key-round" class="w-4 h-4"></i><span>تحديث كلمة المرور</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </main>
    </div>
    
    <script>
        let sidebarCollapsed = false;
        function toggleSidebar() { const t=document.getElementById("sidebar"),e=document.getElementById("main-content");sidebarCollapsed=!sidebarCollapsed,t.classList.toggle("sidebar-expanded"),t.classList.toggle("sidebar-collapsed"),e.classList.toggle("main-content-expanded"),e.classList.toggle("main-content-collapsed"),lucide.createIcons()}
        function applyTheme(t){const e=document.documentElement,i=document.getElementById("theme-icon-light"),d=document.getElementById("theme-icon-dark");"dark"===t?(e.classList.add("dark"),i&&i.classList.add("hidden"),d&&d.classList.remove("hidden")):(e.classList.remove("dark"),i&&i.classList.remove("hidden"),d&&d.classList.add("hidden"))}
        function toggleTheme(){const t="dark"===localStorage.getItem("theme")?"light":"dark";localStorage.setItem("theme",t),applyTheme(t)}
        document.addEventListener("DOMContentLoaded",()=>{document.documentElement.lang="ar",document.documentElement.dir="rtl";const t=localStorage.getItem("theme")||"light";applyTheme(t);const e="settings.html";document.querySelectorAll(".nav-item").forEach(t=>{const i=t.getAttribute("href");i&&i.includes(e)&&t.classList.add("active")});const i=document.querySelector(".nav-item.active .nav-text");document.getElementById("page-title-header").textContent=i?i.textContent:"الصفحة الرئيسية";document.body.style.visibility="visible",document.body.style.opacity="1",lucide.createIcons()});
    </script>
    <script type="module" src="js/settings.js"></script>
</body>
</html>